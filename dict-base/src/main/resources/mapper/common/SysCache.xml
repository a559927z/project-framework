<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="net.chinahrd.module.SysCacheDao">

    <!-- 配置表 -->
    <select id="queryConfig" resultType="net.chinahrd.entity.dto.pc.common.ConfigDto">
		select 
			config_id AS configId,
			config_key AS configKey,
			config_val AS configVal,
			function_id AS functionId,
			note AS note
		from dict_config where customer_id=#{customerId}
	</select>

    <!-- 机构与所有子孙机构的关系 -->
    <select id="queryAllOrganRelation" resultType="net.chinahrd.entity.dto.KVItemDto">
		SELECT 
			t2.organization_id k, t1.organization_id v 
		FROM dict_dim_organization t1,
			(SELECT t.full_path,t.organization_id FROM dict_dim_organization t WHERE  t.customer_id = #{customerId}) t2
		WHERE
			locate(t2.full_path, t1.full_path)
		AND t1.customer_id = #{customerId}
	</select>

    <select id="queryUnderAllOrganRelation" resultType="net.chinahrd.entity.dto.KVItemDto">
		SELECT 
			t1.organization_id k, concat(t2.organization_id, "," ,t2.organization_key, "," ,t2.organization_name) v
		FROM 
			dict_dim_organization t1
		INNER JOIN dict_dim_organization t2 on t1.organization_id = t2.organization_parent_id AND t1.customer_id = t2.customer_id
		LEFT JOIN dict_dim_organization_type dot ON dot.organization_type_id = t1.organization_type_id
		WHERE t1.customer_id = #{customerId}
		ORDER BY dot.organization_type_level
	</select>



    <select id="queryFunction" resultType="net.chinahrd.entity.dto.pc.admin.FunctionDto">
		SELECT function_id functionId, function_name functionName, url FROM `dict_dim_function` WHERE is_menu = 0 and customer_id =#{customerId}
	</select>
	
    <!-- 查出superAdmin的ID -->
    <select id="findSuperAdminId" resultType="java.lang.String">
        SELECT user_id from `dict_dim_user` where sys_deploy = 1 and customer_id=#{customerId}
    </select>
	
	


    <!-- ########### -->
    <!-- 	维度表	 -->
    <!-- ########### -->

	<!-- 根据不同条件查询字典表 -->
	<select id="querySoureCodeItem" resultType="net.chinahrd.entity.dto.KVItemDto">
		SELECT sys_code_item_id k, sys_code_item_name v
		FROM `dict_sys_code_item` where code_group_id = #{groupId} AND customer_id =#{customerId}
		ORDER BY show_index 
	</select>
	<!-- 机构  -->
	<select id="queryOrgan" resultType="net.chinahrd.entity.dto.KVItemDto">
		SELECT organization_id k, organization_name v
		FROM `dict_dim_organization` t
		INNER JOIN dict_dim_organization_type t2 on t.organization_type_id = t2.organization_type_id
		WHERE t.customer_id =#{customerId}
		ORDER BY t2.organization_type_level
	</select>
	<!-- 市  -->
	<select id="queryCity" resultType="net.chinahrd.entity.dto.KVItemDto">
		SELECT city_id k, city_name v
		FROM `public_dim_city` t
		WHERE t.customer_id =#{customerId}
		ORDER BY t.show_index
	</select>
</mapper>